<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=zh-cn lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.68.3"><meta name=viewport content="width=device-width,initial-scale=1"><title>uuid 从 32 字符缩小为 16 个字符 &#183; Chyroc的博客</title><meta name=description content><link type=text/css rel=stylesheet href=https://chyroc.cn/css/print.css media=print><link type=text/css rel=stylesheet href=https://chyroc.cn/css/poole.css><link type=text/css rel=stylesheet href=https://chyroc.cn/css/syntax.css><link type=text/css rel=stylesheet href=https://chyroc.cn/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-08><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://chyroc.cn><h1>Chyroc的博客</h1></a><p class=lead></p></div><nav><ul class=sidebar-nav><li><a href=https://chyroc.cn>Home</a></li><li><a href=/>主页</a></li><li><a href=/blogroll/>友链</a></li><li><a href=/about/>关于</a></li></ul></nav></div></aside><main class="content container"><div class=post><h1>uuid 从 32 字符缩小为 16 个字符</h1><time datetime=2017-08-02T16:45:14+0800 class=post-date>2017-08-02 16:45:14</time><h2 id=起因>起因</h2><p>老大说自增 id 作为主键不好:容易爬。需要换成一个随机串</p><h2 id=选取方案>选取方案</h2><p>第一个想到的就是 mongodb 的 objectid，前几天刚看的，但是想一想还要实现一遍，还是不要了，写得越多错的越多。</p><p>第二个想到的就是 uuid（v4 版本）了，16 字节，但是 golang 本身提供的<code>uuid.NewV4().String()</code>是用 16 进制搞的，会有 32 个字符，有点长。</p><h2 id=决定用-64-进制搞短一下>决定用 64 进制搞短一下</h2><p>选取的字符集是 10 个数字 + 26 大写字母 + 26 小写字母 + <code>+</code> + <code>-</code>，最后一个 uuid 只有 16 个字符</p><p>代码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;fmt&#34;</span>

	<span style=color:#e6db74>&#34;github.com/satori/go.uuid&#34;</span>
)

<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>base64Table</span> = [<span style=color:#ae81ff>64</span>]<span style=color:#66d9ef>byte</span>{
	<span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;2&#39;</span>, <span style=color:#e6db74>&#39;3&#39;</span>, <span style=color:#e6db74>&#39;4&#39;</span>, <span style=color:#e6db74>&#39;5&#39;</span>, <span style=color:#e6db74>&#39;6&#39;</span>, <span style=color:#e6db74>&#39;7&#39;</span>, <span style=color:#e6db74>&#39;8&#39;</span>, <span style=color:#e6db74>&#39;9&#39;</span>,
	<span style=color:#e6db74>&#39;A&#39;</span>, <span style=color:#e6db74>&#39;B&#39;</span>, <span style=color:#e6db74>&#39;C&#39;</span>, <span style=color:#e6db74>&#39;D&#39;</span>, <span style=color:#e6db74>&#39;E&#39;</span>, <span style=color:#e6db74>&#39;F&#39;</span>, <span style=color:#e6db74>&#39;G&#39;</span>, <span style=color:#e6db74>&#39;H&#39;</span>, <span style=color:#e6db74>&#39;I&#39;</span>, <span style=color:#e6db74>&#39;J&#39;</span>, <span style=color:#e6db74>&#39;K&#39;</span>, <span style=color:#e6db74>&#39;L&#39;</span>, <span style=color:#e6db74>&#39;M&#39;</span>, <span style=color:#e6db74>&#39;N&#39;</span>, <span style=color:#e6db74>&#39;O&#39;</span>, <span style=color:#e6db74>&#39;P&#39;</span>, <span style=color:#e6db74>&#39;Q&#39;</span>, <span style=color:#e6db74>&#39;R&#39;</span>, <span style=color:#e6db74>&#39;S&#39;</span>, <span style=color:#e6db74>&#39;T&#39;</span>, <span style=color:#e6db74>&#39;U&#39;</span>, <span style=color:#e6db74>&#39;V&#39;</span>, <span style=color:#e6db74>&#39;W&#39;</span>, <span style=color:#e6db74>&#39;X&#39;</span>, <span style=color:#e6db74>&#39;Y&#39;</span>, <span style=color:#e6db74>&#39;Z&#39;</span>,
	<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;e&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>, <span style=color:#e6db74>&#39;h&#39;</span>, <span style=color:#e6db74>&#39;i&#39;</span>, <span style=color:#e6db74>&#39;j&#39;</span>, <span style=color:#e6db74>&#39;k&#39;</span>, <span style=color:#e6db74>&#39;l&#39;</span>, <span style=color:#e6db74>&#39;m&#39;</span>, <span style=color:#e6db74>&#39;n&#39;</span>, <span style=color:#e6db74>&#39;o&#39;</span>, <span style=color:#e6db74>&#39;p&#39;</span>, <span style=color:#e6db74>&#39;q&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>, <span style=color:#e6db74>&#39;s&#39;</span>, <span style=color:#e6db74>&#39;t&#39;</span>, <span style=color:#e6db74>&#39;u&#39;</span>, <span style=color:#e6db74>&#39;v&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>, <span style=color:#e6db74>&#39;x&#39;</span>, <span style=color:#e6db74>&#39;y&#39;</span>, <span style=color:#e6db74>&#39;z&#39;</span>,
	<span style=color:#e6db74>&#39;+&#39;</span>, <span style=color:#e6db74>&#39;-&#39;</span>,
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>UUIDV4Short</span>() <span style=color:#66d9ef>string</span> {
	<span style=color:#a6e22e>src</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>uuid</span>.<span style=color:#a6e22e>NewV4</span>().<span style=color:#a6e22e>Bytes</span>()
	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>dst</span> = make([]<span style=color:#66d9ef>byte</span>, <span style=color:#ae81ff>16</span>)

	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>src</span> {
		<span style=color:#a6e22e>dst</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>base64Table</span>[<span style=color:#a6e22e>v</span><span style=color:#f92672>&gt;&gt;</span><span style=color:#ae81ff>2</span>]
	}

	<span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>dst</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;uuid: %s\n&#34;</span>, <span style=color:#a6e22e>UUIDV4Short</span>())
}
</code></pre></div><p>感觉这个可以给一个启示：https://www.v2ex.com/t/388152?p=3</p></div><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src=../../js/jquery-3.3.1.min.js></script><script src=../../js/code.js></script><script src=../../css/highlight.css></script><script src=../../js/instantclick.min.js data-no-instant></script><script data-no-instant>InstantClick.init();</script><script>hljs.configure({languages:[]});hljs.initHighlightingOnLoad();</script><hr>© <a href=https://chyroc.cn>chyroc</a> <a href=https://github.com/spf13/hyde>Theme By hyde</a> 2020
<span id=reading-statistics><span><div id=git-comments></div><link rel=stylesheet href=https://imsun.github.io/gitment/style/default.css><script src=https://imsun.github.io/gitment/dist/gitment.browser.js></script><script>var gitment=new Gitment({id:'uuid-reduced-from-32-to-16-chars',title:'uuid 从 32 字符缩小为 16 个字符',owner:'chyroc',repo:'blog',oauth:{client_id:'36628d87f0ace3c0f34c',client_secret:'814e29f878a31ddf2a0f8f010c2bc3615750a998',}})
gitment.render('git-comments')</script></main></body></html>